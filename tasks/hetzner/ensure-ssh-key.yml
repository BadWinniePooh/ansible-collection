---
# Uploads the local SSH public key to Hetzner Cloud, overwriting any existing
# key registered under the same name. This makes provisioning machine-independent:
# each machine's key is registered fresh at provision time and removed at destroy time.
#
# Required vars (passed by caller):
#   hcloud_token        - Hetzner API token
#   hcloud_ssh_key_name - local key filename (without .pub)

- name: Upload SSH public key to Hetzner Cloud
  hetzner.hcloud.ssh_key:
    api_token: "{{ hcloud_token }}"
    state: present
    name: "{{ hcloud_ssh_key_name }}"
    public_key: "{{ lookup('file', '~/.ssh/' + hcloud_ssh_key_name + '.pub') }}"
    force: true